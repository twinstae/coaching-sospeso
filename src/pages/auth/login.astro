---
import { LoginForm } from "@/components/auth/LoginForm.tsx";
import Layout from "@/layouts/Layout.astro";
---

<Layout title="코칭 소스페소 로그인">
  <LoginForm client:load />
</Layout>

<script>
  import { authApi } from "@/adapters/authApi.ts";
  import { toastifyToastApi } from "@/adapters/toastApi.tsx";
  import { magicLinkLoginBus } from "@/components/auth/LoginForm.tsx";
  import { navigate } from "@/routing/navigate";

  const toastApi = toastifyToastApi;

  magicLinkLoginBus.on(window.document.body, (command) => {
    authApi.login.emailPassword(command).then((result) => {
      if (result === "success") {
        navigate("홈", { page: 1 });
        return;
      }

      if (result === "invalid-email-or-password") {
        toastApi.toast("이메일이나 비밀번호를 확인해주세요!", "error");

        return;
      }
    });
  });
</script>
