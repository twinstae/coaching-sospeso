---
import { SospesoConsumingForm } from "@/components/SospesoConsumingForm.tsx";
import Layout from "@/layouts/Layout.astro";
---

<Layout title="소스페소 발행하기">
  <SospesoConsumingForm client:load />
</Layout>

<script>
  import { sospesoConsumingEventBus } from "@/components/SospesoConsumingForm.tsx";
  import { navigate } from "@/routing/navigate.ts";
  import { getParsedParams } from "@/routing/parseRouteParams.ts";
  import { actions } from "astro:actions";

  sospesoConsumingEventBus.on(window.document.body, (command) => {
    const { sospesoId, consumerId } = getParsedParams("어드민-소스페소-사용");

    actions
      .consumeSospeso({
        ...command,
        sospesoId,
        consumerId,
      })
      .then(() => {
        navigate("소스페소-상세", { sospesoId });
      });
  });
</script>
